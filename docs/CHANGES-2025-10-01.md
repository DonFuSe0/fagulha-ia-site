# Fagulha – Correções mínimas (01-10-2025)

Este pacote NÃO altera o código do site. Ele adiciona somente **scripts SQL** e documentação
para corrigir os pontos confirmados nos seus testes:

1. **profiles.ip_hash ausente** → adicionamos a coluna (sem quebrar fluxo atual).
2. **RLS desabilitado** em `signup_attempts`, `signup_guards`, `webhook_events` → habilitamos RLS e
   criamos políticas que permitem apenas `service_role` (as rotas server usam essa chave).
3. **Índices** em `ip_hash` para desempenho.

> Após aplicar os scripts em ordem, os avisos do linter do Supabase devem sumir e o `PATCH` do `ip_hash`
> deixará de falhar silenciosamente.

## Como aplicar
1. Abra o **SQL Editor** do Supabase em **Production** (ou o ambiente alvo).
2. Execute **na ordem**:
   - `001_add_ip_hash_to_profiles.sql`
   - `002_enable_rls_signup_tables.sql`
   - `003_policies_service_role_only.sql`
   - `004_indexes.sql`
   - (opcional) `005_verify_state.sql`
3. Teste: novo cadastro + verificação do `ip_hash` e logs do PostgREST.

## Sem mudanças de código
Nenhuma mudança em arquivos do Next.js é necessária para estas correções. Se você quiser, futuramente
eu posso adicionar **logs/telemetria** para evitar falhas silenciosas, sem alterar o UX.
